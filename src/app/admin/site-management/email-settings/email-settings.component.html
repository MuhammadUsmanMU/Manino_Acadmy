<div class="manage-pages-container">
  <div class="add-page-form">
    <h3>Update email template</h3>
    <form (submit)="onSubmit($event)">
      <label for="emailSettingVariables">
        Email setting variables <i class="bi bi-info-circle"></i>
      </label>
      <pre class="email-variables-block" id="emailSettingVariables">
{{ '{' }}studentName{{ '}' }} - For Username
{{ '{' }}assignmentName{{ '}' }} - For Assignment Title
      </pre>

      <label for="subject">Subject</label>
      <input type="text" id="subject" [(ngModel)]="subject" name="subject" />

      <label for="greetingText">Greeting text</label>
      <textarea id="greetingText" [(ngModel)]="greetingText" name="greetingText"></textarea>

      <label for="emailContent">Email Content</label>
      <textarea id="emailContent" [(ngModel)]="emailContent" name="emailContent"></textarea>

      <label>Status:</label>
      <div class="status-toggle">
        <span>Set email status as</span>
        <span>Enabled</span>
        <label class="switch">
          <input
            type="checkbox"
            [checked]="emailStatusEnabled"
            (change)="onStatusChange($event)"
          />
          <span class="slider round"></span>
        </label>
      </div>

      <button type="submit">Update Email Template</button>
    </form>
  </div>

  <div class="pages-table">
    <div class="table-header">
      <h3>All Email Templates ({{ table.length }})</h3>
      <div class="filters">
        <!-- Sort Dropdown -->
        <div class="custom-dropdown" (click)="toggleSortDropdown()">
          <span>{{ selectedSort || 'Sort By' }}</span>
          <i class="fa-solid fa-caret-down"></i>
          <ul *ngIf="showSortDropdown" class="dropdown-options">
              <li (click)="selectSort('Asc')">Asc</li>
              <li (click)="selectSort('Desc')">Desc</li>
          </ul>
        </div>

        <!-- Limit Dropdown -->
        <div class="custom-dropdown" (click)="toggleLimitDropdown()">
          <span>{{ selectedLimit || 'Items per page' }}</span>
          <i class="fa-solid fa-caret-down"></i>
          <ul *ngIf="showLimitDropdown" class="dropdown-options">
            <li (click)="selectLimit(10)">10</li>
            <li (click)="selectLimit(20)">20</li>
            <li (click)="selectLimit(30)">30</li>
            <li (click)="selectLimit(40)">40</li>
          </ul>
        </div>

        <!-- Search -->
        <div class="search">
          <i class="fa-solid fa-magnifying-glass"></i>
          <input 
             type="text" 
             placeholder="Search"
             [(ngModel)]="searchTerm"
             (ngModelChange)="currentPage = 1"
            />
        </div>
      </div>
    </div>

    <div class="table-responsive">
      <table>
        <thead>
          <tr class="head">
            <th>#</th>
            <th>Email title</th>
            <th>Role type</th>
            <th>Status</th>
            <th class="actions-heading">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of paginatedTable" class="data">
            <td>{{ item.id }}</td>
            <td>{{ item.emailTitle }}</td>
            <td>{{ item.roleType }}</td>
            <td>
              <span class="tag">
                <span
                  class="dot"
                  [ngStyle]="{
                    background: item.status === 'ENABLED' ? '#28a745' : '#d9534f'
                  }"
                ></span>
                {{ item.status }}
              </span>
            </td>
            <td class="action-icons">
              <i class="bi bi-pencil"></i>
              <i class="bi bi-trash"></i>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination">
      <i
        class="bi bi-chevron-left"
        (click)="prevPage()"
        [class.disabled]="currentPage === 1"
      ></i>

      <span
        *ngFor="let page of [].constructor(totalPages); let i = index"
        [class.active]="currentPage === i + 1"
        (click)="changePage(i + 1)"
      >
        {{ i + 1 }}
      </span>

      <i
        class="bi bi-chevron-right"
        (click)="nextPage()"
        [class.disabled]="currentPage === totalPages"
      ></i>
    </div>
  </div>
</div>
